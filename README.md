# Android components for Nugget

Android communicates with Nugget apps in order to implement security related
HALs. Currently, those HALs are Keymaster, Weaver and OemLock.

## libnos

libnos offers the `NuggetClient` interface that should be used by the HALs.
`AppClient` is a wrapper around a `NuggetClient` for talking to a specific app.

Nugget can be implemented on a number of chips with different drivers so the
NuggetClient interface must be implemented for the hardware in use. This
interface also allows proxing via a synchronizing service and injecting mocks
for testing.

### Services

Work in progress.

Apps that define a protobuf service will have an app interface class
autogenerated. These classes will wrap a `NuggetClient`.

### Asynchronous communication

Work in progress.

Currently, everything is synchronous and just exposes the `call_application()`
function from the Nugget transport API. In future, asynchronous calls may be
desired. Support for this could be added in:

   * Nugget transport API
   * `NuggetClient` on top of `call_application()`
   * Generated services

## citadeld

Citadel will be running Nugget. In order to synchronize access to the driver /
bus, HALs should proxy all communication via the `citadeld` daemon which will be
the only service with driver access.

Synchronizing with this service, rather than in the driver, allows for easier
debugging and fixing should the need arise.

`CitadeldProxyClient` will implement `NuggetClient` to handle proxying
communication via `citadeld` without requiring change to the HALs.
